<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>AS_VEER ¬∑ birthday</title>
  <link rel="icon" type="image/png" href="icon.png">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      min-height: 100vh;
      background: radial-gradient(circle at 30% 30%, #2a2235, #130e1c);
      font-family: 'Inter', 'system-ui', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      color: #f0e6f0;
      -webkit-font-smoothing: antialiased;
    }

    /* ---------- shared screen / step management ---------- */
    .step {
      position: relative;
      width: 100%;
      max-width: 1000px;
      transition: opacity 0.6s ease;
    }
    .hidden-step {
      display: none !important;
    }

    /* ---------- calendar screen ---------- */
    .calendar-screen {
      background: rgba(10, 8, 15, 0.5);
      backdrop-filter: blur(16px);
      border-radius: 3rem;
      padding: 3rem 2rem;
      border: 1px solid rgba(255,210,200,0.3);
      box-shadow: 0 40px 70px -15px black, inset 0 0 40px rgba(160,120,100,0.3);
      text-align: center;
    }
    .calendar-icon {
      font-size: 5rem;
      filter: drop-shadow(0 0 20px #c99f6b);
      margin-bottom: 1rem;
    }
    .time-digits {
      font-family: 'Courier New', monospace;
      font-size: 4rem;
      font-weight: 300;
      background: rgba(0,0,0,0.4);
      padding: 1rem 2rem;
      border-radius: 5rem;
      letter-spacing: 8px;
      border: 2px solid rgba(255,200,150,0.5);
      display: inline-block;
      color: #ffebcc;
      text-shadow: 0 0 10px #ffb47b;
      margin: 1rem 0 0.5rem;
    }
    .date-digits {
      font-family: 'Courier New', monospace;
      font-size: 2.8rem;
      font-weight: 300;
      background: rgba(0,0,0,0.3);
      padding: 0.8rem 2rem;
      border-radius: 4rem;
      letter-spacing: 4px;
      border: 1px solid rgba(255,200,150,0.4);
      display: inline-block;
      color: #ffd9b3;
      margin-bottom: 1rem;
    }
    .calendar-label {
      font-size: 1.3rem;
      color: #e0c0a8;
      margin-top: 0.5rem;
    }
    @media (max-width:600px){
      .time-digits { font-size: 2.5rem; letter-spacing: 4px; }
      .date-digits { font-size: 2rem; }
    }

    /* ---------- firecracker animation canvas with stats ---------- */
    .fire-screen {
      background: rgba(0,0,0,0.3);
      backdrop-filter: blur(20px);
      border-radius: 4rem;
      padding: 3rem 2rem;
      text-align: center;
      border: 1px solid rgba(255,200,100,0.5);
      box-shadow: 0 0 80px #ff9040;
      position: relative;
      min-height: 650px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #fireCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 4rem;
      pointer-events: none;
      z-index: 1;
    }
    .fire-title {
      font-size: 4rem;
      font-weight: 300;
      background: linear-gradient(145deg,#fff2c0,#ffb27a);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 1rem;
      z-index: 2;
      position: relative;
    }
    .age-stats-fire {
      background: rgba(10, 5, 10, 0.7);
      backdrop-filter: blur(10px);
      border-radius: 3rem;
      padding: 1.8rem 2rem;
      margin: 1rem 0 2rem;
      border: 1px solid rgba(255,215,170,0.4);
      font-family: 'Courier New', monospace;
      text-align: center;
      color: #ffdbb5;
      line-height: 1.9;
      font-size: 1.3rem;
      box-shadow: 0 15px 30px -5px black;
      z-index: 2;
      position: relative;
      width: 90%;
      max-width: 600px;
    }
    .age-stats-fire div { margin: 0.2rem 0; }
    .age-highlight {
      font-size: 2rem;
      font-weight: 350;
      color: #ffb87a;
      margin-bottom: 0.8rem;
    }
    .fire-next-btn {
      background: rgba(255,160,100,0.2);
      border: 2px solid #ffb27a;
      padding: 1rem 3rem;
      border-radius: 4rem;
      font-size: 1.8rem;
      color: white;
      margin-top: 1rem;
      cursor: pointer;
      transition: 0.3s;
      z-index: 2;
      position: relative;
    }
    .fire-next-btn:hover { background: #ff9633; transform:scale(1.05);}

    /* ---------- pig reveal ---------- */
    .pig-screen {
      background: rgba(20,15,30,0.5);
      backdrop-filter: blur(18px);
      border-radius: 3rem;
      padding: 3rem 2rem;
      text-align: center;
    }
    .pig-emojiBig { font-size: 8rem; animation: float 3s infinite; }
    @keyframes float { 0%{transform:translateY(0);} 50%{transform:translateY(-15px);} }
    .pig-btn {
      background: rgba(255,240,255,0.15);
      border: 2px solid #ffb6f0;
      padding: 1.2rem 3.5rem;
      border-radius: 5rem;
      font-size: 2rem;
      color: white;
      margin-top: 2rem;
      cursor: pointer;
    }

    /* ---------- gift box + name validation ---------- */
    .gift-screen {
      background: rgba(20,12,28,0.6);
      backdrop-filter: blur(18px);
      border-radius: 3rem;
      padding: 2.5rem 2rem;
      text-align: center;
      border: 1px solid rgba(255,220,180,0.3);
    }
    .gift-title { font-size: 2rem; margin-bottom: 1rem; color: #ffdbbe; }
    .gift-box {
      width: 200px; height: 200px;
      background: #8a6f5c;
      margin: 1rem auto;
      border-radius: 30px 30px 50px 50px;
      box-shadow: 0 20px 30px black;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 5rem;
      border: 3px solid #dbb48b;
    }
    .name-input {
      background: rgba(255,255,240,0.1);
      border: 2px solid #cb9e7a;
      padding: 1rem;
      width: 80%;
      max-width: 300px;
      border-radius: 3rem;
      font-size: 1.3rem;
      color: white;
      text-align: center;
      margin: 1.5rem auto 0.5rem;
    }
    .hint-apple { font-size: 2.5rem; margin: 0.5rem; opacity: 0.7; }
    .error-msg { color: #ff8888; min-height: 2rem; }
    .validate-btn {
      background: #b38b6b;
      border: none;
      padding: 0.8rem 2rem;
      border-radius: 3rem;
      font-size: 1.5rem;
      color: white;
      margin: 1rem;
      cursor: pointer;
    }

    /* ---------- carousel page with images and music card ---------- */
    .carousel-screen {
      background: rgba(15,10,20,0.3);
      backdrop-filter: blur(20px);
      border-radius: 3rem;
      padding: 2rem 1.5rem;
    }
    h1 { font-size: 2.8rem; font-weight: 330; background: linear-gradient(135deg,#fff,#eac0ff); -webkit-background-clip: text; background-clip: text; color: transparent; margin-bottom: 0.5rem; }
    .sub { color: rgba(255,230,255,0.7); margin-bottom: 1.5rem; }

    /* Music card with album image and player */
    .music-placeholder-card {
      background: rgba(20, 12, 25, 0.6);
      backdrop-filter: blur(12px);
      border-radius: 3rem;
      padding: 1.2rem 1.8rem;
      margin: 1rem 0 2rem;
      display: flex;
      align-items: center;
      gap: 1.5rem;
      border: 1px solid rgba(255,200,230,0.3);
      box-shadow: 0 15px 30px -8px black;
      flex-wrap: wrap;
    }
    .music-image {
      width: 70px;
      height: 70px;
      border-radius: 35px;
      overflow: hidden;
      box-shadow: 0 8px 15px -3px black;
      flex-shrink: 0;
      border: 2px solid rgba(255,210,220,0.5);
    }
    .music-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .music-info {
      flex: 1;
      min-width: 200px;
    }
    .music-song-name {
      font-size: 1.6rem;
      font-weight: 320;
      color: #ffd9b3;
      letter-spacing: 0.5px;
    }
    .music-artist {
      font-size: 1.1rem;
      color: rgba(255,220,200,0.7);
      margin-bottom: 0.5rem;
    }

    /* Audio player styling - works with progress bar */
    #bgMusic {
      width: 100%;
      height: 45px;
      border-radius: 30px;
      background: rgba(20, 10, 15, 0.8);
      margin-top: 12px;
    }

    /* Chrome/Safari styling */
    #bgMusic::-webkit-media-controls-panel {
      background: linear-gradient(145deg, #2a1f2a, #1a121f);
      border-radius: 30px;
    }

    #bgMusic::-webkit-media-controls-current-time-display,
    #bgMusic::-webkit-media-controls-time-remaining-display {
      color: #ffd9b3;
      font-family: 'Courier New', monospace;
      font-size: 14px;
    }

    #bgMusic::-webkit-media-controls-play-button,
    #bgMusic::-webkit-media-controls-mute-button {
      background-color: rgba(255, 200, 220, 0.2);
      border-radius: 50%;
      width: 30px;
      height: 30px;
    }

    #bgMusic::-webkit-media-controls-timeline {
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      height: 6px;
      margin: 0 10px;
    }

    /* carousel with images */
    .carousel-mask {
      overflow: hidden;
      border-radius: 2rem;
      mask-image: linear-gradient(to right, transparent, black 12%, black 88%, transparent);
      -webkit-mask-image: linear-gradient(to right, transparent, black 12%, black 88%, transparent);
    }
    .carousel-track {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      padding: 1rem 0;
    }
    .carousel-track::-webkit-scrollbar { display: none; }
    .carousel-item {
      flex: 0 0 auto;
      width: 240px;
      scroll-snap-align: center;
      border-radius: 2rem;
      overflow: hidden;
      opacity: 0.6;
      transform: scale(0.88);
      transition: 0.3s;
      box-shadow: 0 20px 30px -8px black;
    }
    .carousel-item.active-center { opacity: 1; transform: scale(1.1); filter: brightness(1.1); }
    .carousel-item img {
      width: 100%;
      height: 280px;
      object-fit: cover;
      display: block;
    }
    .carousel-nav { display: flex; gap: 1rem; justify-content: center; margin: 1rem; }
    .nav-btn {
      background: rgba(255,255,255,0.1);
      border: 1px solid #ffb6f0;
      width: 3rem; height: 3rem;
      border-radius: 50%;
      font-size: 2rem;
      color: white;
      cursor: pointer;
    }

   /* old paper letter - CLEAN VERSION (no scrollbar) */
.letter-card {
  background: #dac09a;
  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><filter id="noise" x="0%" y="0%" width="100%" height="100%"><feTurbulence type="fractalNoise" baseFrequency="0.6" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100" height="100" filter="url(%23noise)" opacity="0.1"/></svg>');
  background-blend-mode: overlay;
  background-color: #e5cfb4;
  border-radius: 3rem;
  padding: 2rem;
  box-shadow: 0 25px 40px -10px black, inset 0 0 40px #ffeedd;
  border: 2px solid #b48b65;
  color: #3e2e1c;
  margin: 1.5rem 0;
}

.letter-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
}

.envelope-symbol {
  font-size: 2rem;
  filter: drop-shadow(0 5px 6px #553e2a);
  color: #5a3e28;
}

.btn-open {
  background: #b38b5e;
  border: none;
  padding: 0.8rem 2rem;
  border-radius: 3rem;
  font-size: 1.3rem;
  color: white;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 5px 10px -3px rgba(0,0,0,0.3);
}

.btn-open:hover {
  background: #9e7a52;
  transform: scale(1.02);
}

.message-reveal {
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  transition: max-height 1.2s cubic-bezier(0.4, 1, 0.3, 1), opacity 0.8s ease;
  background: rgba(255,240,210,0.7);
  border-radius: 2rem;
  margin-top: 0;
  width: 100%;
}

.message-reveal.show {
  max-height: 2000px; /* Very large to fit all content */
  opacity: 1;
  margin-top: 2rem;
  padding: 2rem;
  overflow: visible; /* NO SCROLLBAR */
}

.love-text {
  font-size: 1.4rem;
  font-weight: 320;
  color: #4b2e1a;
  line-height: 1.8;
  text-align: left;
  white-space: normal;
  word-wrap: break-word;
  font-family: 'Georgia', 'Times New Roman', serif;
  text-shadow: 0 1px 2px rgba(255,255,200,0.3);
  letter-spacing: 0.3px;
}

.placeholder-sub {
  font-size: 0.9rem;
  color: #6b4d34;
  margin-top: 2rem;
  text-align: center;
  opacity: 0.5;
  border-top: 1px dashed #b48b65;
  padding-top: 1rem;
}

/* For mobile */
@media (max-width:700px) {
  .love-text {
    font-size: 1.2rem;
    line-height: 1.6;
  }
  .message-reveal.show {
    padding: 1.5rem;
  }
  .letter-card {
    padding: 1.5rem;
  }
  .envelope-symbol {
    font-size: 1.6rem;
  }
  .btn-open {
    padding: 0.6rem 1.5rem;
    font-size: 1.1rem;
  }
}
    /* Memory pop-up styling */
    .memory-popup {
      position: fixed;
      background: rgba(30, 20, 35, 0.9);
      backdrop-filter: blur(12px);
      border: 2px solid rgba(255, 200, 220, 0.5);
      border-radius: 3rem;
      padding: 15px 25px;
      color: #ffd9b3;
      font-family: 'Inter', sans-serif;
      font-size: 1.2rem;
      font-weight: 320;
      letter-spacing: 0.5px;
      box-shadow: 0 20px 40px -10px black, 0 0 40px rgba(255, 180, 210, 0.4);
      z-index: 10000;
      pointer-events: none;
      animation: floatUp 4s ease-out forwards;
      max-width: 280px;
      text-align: center;
      line-height: 1.5;
      white-space: nowrap;
    }

    @keyframes floatUp {
      0% {
        opacity: 0;
        transform: translateY(30px) scale(0.7);
      }
      15% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      80% {
        opacity: 1;
        transform: translateY(-30px) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-80px) scale(0.6);
      }
    }

    /* Responsive */
    @media (max-width:700px){
      h1{font-size:2rem;} .carousel-item{width:180px;} .carousel-item img{height:220px;}
      .age-stats-fire{font-size:1rem;} .age-highlight{font-size:1.6rem;}
      .fire-title{font-size:2.5rem;}
      .music-placeholder-card { flex-direction: column; align-items: flex-start; }
      .music-image { width: 60px; height: 60px; }
      .music-song-name { font-size: 1.3rem; }
      .memory-popup {
        font-size: 1rem;
        padding: 10px 18px;
        white-space: normal;
        max-width: 220px;
      }
    }
  </style>
</head>
<body>
  <!-- STEP 1: calendar screen -->
  <div id="step1" class="step calendar-screen">
    <div class="calendar-icon">üìÖ</div>
    <div class="time-digits" id="currentTime">--:--:--</div>
    <div class="date-digits" id="currentDate">-- --- ----</div>
    <div class="calendar-label">Get ready for the surprise!</div>
  </div>

  <!-- STEP 2: firecracker screen with 19yr stats -->
  <div id="step2" class="step fire-screen hidden-step">
    <canvas id="fireCanvas"></canvas>
    <div class="fire-title">üéâ happy birthday bangaram üéâ</div>
    <div class="age-stats-fire">
      <div class="age-highlight">üéÇ you turned 19yrs üéÇ</div>
      <div>19 years 0 months 0 days</div>
      <div>or 228 months 0 days</div>
      <div>or 991 weeks 3 days</div>
      <div>or 6,940 days</div>
      <div>or 166,560 hours</div>
      <div>or 9,993,600 minutes</div>
      <div>or 599,616,000 seconds</div>
    </div>
    <button class="fire-next-btn" id="fireNextBtn">continue ‚Üí</button>
  </div>

  <!-- STEP 3: pig emoji + click me -->
  <div id="step3" class="step pig-screen hidden-step">
    <div class="pig-emojiBig">üê∑</div>
    <button class="pig-btn" id="pigRevealBtn">click me</button>
  </div>

  <!-- STEP 4: gift box with validation -->
  <div id="step4" class="step gift-screen hidden-step">
    <div class="gift-title">here is your gift üéÅ</div>
    <div class="gift-box">üêª‚Äç‚ùÑÔ∏è</div>
    <div>enter your fav person name:</div>
    <input class="name-input" id="nameInput" placeholder="type here" autocomplete="off">
    <div class="hint-apple"></div>
    <div class="error-msg" id="nameError"></div>
    <button class="validate-btn" id="validateNameBtn">unlock</button>
  </div>

  <!-- STEP 5: carousel with images + music card + old paper letter -->
  <div id="step5" class="step carousel-screen hidden-step">
    <h1>for the one i love</h1>
    <div class="sub">pandu forever for pandi</div>

    <!-- Music Player Card with working audio (single instance) -->
    <div class="music-placeholder-card">
      <div class="music-image">
        <img src="song.jpg" alt="A Thousand Years">
      </div>
      <div class="music-info">
        <div class="music-song-name">A Thousand Years</div>
        <div class="music-artist">Christina Perri</div>
        
        <!-- Single audio player with full controls & progress bar -->
        <audio id="bgMusic" controls preload="auto">
          <source src="song.mp3" type="audio/mpeg">
          Your browser does not support the audio element.
        </audio>
      </div>
    </div>

    <!-- carousel with your images (img1.jpg to img18.jpg) -->
    <div class="carousel-mask">
      <div class="carousel-track" id="carouselTrack">
        <div class="carousel-item"><img src="img1.jpg" alt="memory 1" loading="lazy"></div>
        <div class="carousel-item"><img src="img2.jpg" alt="memory 2" loading="lazy"></div>
        <div class="carousel-item"><img src="img3.jpg" alt="memory 3" loading="lazy"></div>
        <div class="carousel-item"><img src="img4.jpg" alt="memory 4" loading="lazy"></div>
        <div class="carousel-item"><img src="img5.jpg" alt="memory 5" loading="lazy"></div>
        <div class="carousel-item"><img src="img6.jpg" alt="memory 6" loading="lazy"></div>
        <div class="carousel-item"><img src="img7.jpg" alt="memory 7" loading="lazy"></div>
        <div class="carousel-item"><img src="img8.jpg" alt="memory 8" loading="lazy"></div>
        <div class="carousel-item"><img src="img9.jpg" alt="memory 9" loading="lazy"></div>
        <div class="carousel-item"><img src="img10.jpg" alt="memory 10" loading="lazy"></div>
        <div class="carousel-item"><img src="img11.jpg" alt="memory 11" loading="lazy"></div>
        <div class="carousel-item"><img src="img12.jpg" alt="memory 12" loading="lazy"></div>
        <div class="carousel-item"><img src="img13.jpg" alt="memory 13" loading="lazy"></div>
        <div class="carousel-item"><img src="img14.jpg" alt="memory 14" loading="lazy"></div>
        <div class="carousel-item"><img src="img15.jpg" alt="memory 15" loading="lazy"></div>
        <div class="carousel-item"><img src="img16.jpg" alt="memory 16" loading="lazy"></div>
        <div class="carousel-item"><img src="img17.jpg" alt="memory 17" loading="lazy"></div>
        <div class="carousel-item"><img src="img18.jpg" alt="memory 18" loading="lazy"></div>
      </div>
    </div>
    <div class="carousel-nav">
      <button class="nav-btn" id="prevBtn">‚Äπ</button>
      <button class="nav-btn" id="nextBtn">‚Ä∫</button>
    </div>

    <!-- old paper letter -->
    <div class="letter-card">
      <div class="letter-row">
        <span class="envelope-symbol">‚úß  letter for you  ‚úß</span>
        <button class="btn-open" id="openLetterBtn">Open Letter</button>
      </div>
      <div class="message-reveal" id="letterMessage">
        <div class="love-text">Oye bangaram üê∑,<br>
It's been a year without you, but still edho recent gane manam school nunchi velinatu vundi neetho vunna memories alantivi, but sudden ga intha distance perigipothundi anukole manamadhya, epudu chala Miss avthuna I strongly needs your presence. Nuv chepinantha easy kadhu kotha valani parichayam cheskovdam,  ayina avriki interest and kali vuntadi chepu  mana gurinchi patinchukodaniki, your relation is the best for me. No one can replace it. Chalane chedham anukuna nee birthday ki but the distance and time kudaratledhu everyday chala hectic ga vuntundi asala aedhi avaledhu edho edhi chinna wish anthe hope you liked it.<br> 
Chadvulo padi health padu cheskoku, time ki thinnu , time ki padko , water thagu and health jagratha aslaa patinchukuntaledhu nuv. Ila ayithe I hate you ‚ôæÔ∏è.<br>
Inka chala chepali neetho time vunte call chey , chala vishayalu matladali ok naa....!<br>
Ti-Aimo > 3000......<br>
Your's üêª‚Äç‚ùÑÔ∏è.<br></div>
        <div class="placeholder-sub">AS_VEER</div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      // ---------- STEP 1: Calendar display (current time & date in IST) ----------
      const step1 = document.getElementById('step1');
      const step2 = document.getElementById('step2');
      const step3 = document.getElementById('step3');
      const step4 = document.getElementById('step4');
      const step5 = document.getElementById('step5');

      const timeEl = document.getElementById('currentTime');
      const dateEl = document.getElementById('currentDate');

      function getISTDateTime() {
        const now = new Date();
        const localOffset = now.getTimezoneOffset() * 60000;
        const utc = now.getTime() + localOffset;
        const istOffset = 5.5 * 60 * 60 * 1000;
        return new Date(utc + istOffset);
      }

      function updateCalendar() {
        const istNow = getISTDateTime();
        
        const hours = String(istNow.getHours()).padStart(2,'0');
        const minutes = String(istNow.getMinutes()).padStart(2,'0');
        const seconds = String(istNow.getSeconds()).padStart(2,'0');
        timeEl.innerText = `${hours}:${minutes}:${seconds}`;

        const day = String(istNow.getDate()).padStart(2,'0');
        const month = String(istNow.getMonth() + 1).padStart(2,'0');
        const year = istNow.getFullYear();
        dateEl.innerText = `${day}-${month}-${year}`;

        // Unlock on Feb 23 (month=2, day=23) ‚Äî set to 21 for testing
        if (istNow.getMonth() === 1 && istNow.getDate() === 21) {
          if (!step1.classList.contains('hidden-step')) {
            goToStep(step1, step2);
            initFirecracker();
          }
        }
      }

      function goToStep(hideStep, showStep) {
        hideStep.classList.add('hidden-step');
        showStep.classList.remove('hidden-step');
        
        // Start memory popups when step5 is shown
        if (showStep === step5) {
          startMemoryPopups();
        }
        
        // Stop memory popups when leaving step5
        if (hideStep === step5) {
          stopMemoryPopups();
        }
      }

      setInterval(updateCalendar, 1000);
      updateCalendar();

      // ---------- MEMORY POPUPS ----------
      let memoryInterval = null;
      
      const memoryMessages = [
        "12th Augü•∞",
        "Computer Lab sittingü§´",
        "that choclate pass-ons üòä",
        "My stationary boxü§ì",
        "those Ice-Creams üç¶",
        "When you held my hand ü§ç",
        "polar Bear üêª‚Äç‚ùÑÔ∏è",
        "our calling sign üòÑ",
        "piggu üê∑üêΩ",
        "Your presence ",
        "Ti-Aimo>30000 ü©∑",
        "Our inside jokes ü§´",
        "You make everything better",
        "So manu hurtings üò§",
        "AS_VEER ‚ú®",
        "Those waitingsüí´",
        "When you fell asleep on my hand",
        "our lovable conversationsüíå",
        "That time we got lost üó∫Ô∏è",
        "Every moment with you"
      ];

      function createMemoryPopup() {
        const popup = document.createElement('div');
        popup.className = 'memory-popup';
        
        const randomIndex = Math.floor(Math.random() * memoryMessages.length);
        popup.textContent = memoryMessages[randomIndex];
        
        const left = 5 + Math.random() * 80;
        const top = 10 + Math.random() * 70;
        
        popup.style.left = left + '%';
        popup.style.top = top + '%';
        popup.style.position = 'fixed';
        
        const rotate = (Math.random() - 0.5) * 8;
        popup.style.transform = `rotate(${rotate}deg)`;
        
        document.body.appendChild(popup);
        
        setTimeout(() => {
          if (popup.parentNode) popup.remove();
        }, 4000);
      }

      function startMemoryPopups() {
        if (memoryInterval) {
          clearInterval(memoryInterval);
        }
        memoryInterval = setInterval(createMemoryPopup, 2500);
        setTimeout(createMemoryPopup, 100);
      }

      function stopMemoryPopups() {
        if (memoryInterval) {
          clearInterval(memoryInterval);
          memoryInterval = null;
        }
      }

      // ---------- firecracker animation ----------
      function initFirecracker() {
        const canvas = document.getElementById('fireCanvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        let w, h;
        function resizeCanvas() {
          const parent = canvas.parentElement;
          if (!parent) return;
          w = parent.offsetWidth;
          h = parent.offsetHeight;
          canvas.width = w;
          canvas.height = h;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        let particles = [];
        const colors = ['#FFC107', '#FF5722', '#FF4081', '#E040FB', '#FFD700', '#FF8A65', '#FF5252'];

        function createExplosion(centerX, centerY) {
          for (let i = 0; i < 30; i++) {
            const angle = Math.random() * 2 * Math.PI;
            const speed = 3 + Math.random() * 6;
            const vx = Math.cos(angle) * speed;
            const vy = Math.sin(angle) * speed;
            particles.push({
              x: centerX, y: centerY, vx, vy, life: 1.0,
              color: colors[Math.floor(Math.random() * colors.length)],
              size: 5 + Math.random() * 8
            });
          }
        }

        let lastTimestamp = 0;
        function animate(timestamp) {
          const parent = canvas.parentElement;
          if (!parent) return;
          ctx.clearRect(0, 0, w, h);
          
          if (timestamp - lastTimestamp > 300) {
            lastTimestamp = timestamp;
            createExplosion(w * (0.3 + Math.random() * 0.4), h * (0.2 + Math.random() * 0.6));
          }

          for (let i = particles.length - 1; i >= 0; i--) {
            const p = particles[i];
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.08;
            p.life -= 0.008;
            if (p.life <= 0.02 || p.y > h + 50) {
              particles.splice(i, 1);
              continue;
            }
            ctx.globalAlpha = p.life;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size * p.life, 0, 2 * Math.PI);
            ctx.fillStyle = p.color;
            ctx.fill();
          }
          requestAnimationFrame(animate);
        }
        requestAnimationFrame(animate);
      }

      // Button event listeners
      document.getElementById('fireNextBtn').addEventListener('click', ()=>{
        goToStep(step2, step3);
      });

      document.getElementById('pigRevealBtn').addEventListener('click', ()=>{
        goToStep(step3, step4);
      });

      // name validation
      const nameInput = document.getElementById('nameInput');
      const nameError = document.getElementById('nameError');
      const validateBtn = document.getElementById('validateNameBtn');

      validateBtn.addEventListener('click', ()=>{
        const val = nameInput.value.trim();
        if (val.toLowerCase() === 'pandu' || val.toLowerCase() === 'polarbear' || val.toLowerCase() === 'polar bear') {
          goToStep(step4, step5);
          for (let i=0;i<8;i++){ setTimeout(()=>{createConfetti('#ffb0f0');}, i*70); }
          
          // Play music when entering carousel
          setTimeout(() => {
            const audio = document.getElementById('bgMusic');
            if (audio) {
              audio.play().catch(e => console.log('Playback error:', e));
            }
          }, 500);
        } else {
          nameError.innerText = '‚ùå I think i was your favoriteüòíüòî';
        }
      });

      // Play music when continue button is clicked
      document.getElementById('fireNextBtn').addEventListener('click', function() {
        setTimeout(() => {
          const audio = document.getElementById('bgMusic');
          if (audio) {
            audio.play().catch(e => console.log('Playback error:', e));
          }
        }, 300);
      });

      // carousel center detection
      const track = document.getElementById('carouselTrack');
      const items = document.querySelectorAll('.carousel-item');
      function updateCenter() {
        if (!track) return;
        const trackRect = track.getBoundingClientRect();
        const centerX = trackRect.left + trackRect.width/2;
        let closest = null, minDist = Infinity;
        items.forEach(item => {
          const rect = item.getBoundingClientRect();
          const itemCenter = rect.left + rect.width/2;
          const dist = Math.abs(itemCenter - centerX);
          if (dist < minDist) { minDist = dist; closest = item; }
        });
        items.forEach(i => i.classList.remove('active-center'));
        if (closest) closest.classList.add('active-center');
      }
      setTimeout(updateCenter,200);
      track.addEventListener('scroll', updateCenter);
      window.addEventListener('resize', updateCenter);

      document.getElementById('prevBtn').addEventListener('click', ()=>{
        track.scrollBy({ left: -280, behavior: 'smooth' });
      });
      document.getElementById('nextBtn').addEventListener('click', ()=>{
        track.scrollBy({ left: 280, behavior: 'smooth' });
      });

      // open/close letter with toggle button
const openBtn = document.getElementById('openLetterBtn');
const letterMsg = document.getElementById('letterMessage');

openBtn.addEventListener('click', ()=>{
  letterMsg.classList.toggle('show');
  
  // Change button text based on state
  if (letterMsg.classList.contains('show')) {
    openBtn.textContent = 'Close Letter';
    // Confetti when opening
    for (let i=0;i<6;i++){ setTimeout(()=>{createConfetti('#dba56d');}, i*90); }
  } else {
    openBtn.textContent = 'Open Letter';
  }
});

      function createConfetti(color) {
        const dot = document.createElement('div');
        dot.className = 'confetti-dot';
        dot.style.left = Math.random() * window.innerWidth + 'px';
        dot.style.top = Math.random() * window.innerHeight + 'px';
        dot.style.background = color || '#ffcc88';
        document.body.appendChild(dot);
        setTimeout(()=> dot.remove(), 800);
      }
    })();
  </script>
</body>
</html>